{
  "name": "WyÅ‚Ä…czenie wadliwej wydawki",
  "description": "Scenariusz wyÅ‚Ä…czajÄ…cy konkretnÄ… wydawkÄ™ gdy wykryty zostanie bÅ‚Ä…d zwiÄ…zany z tym urzÄ…dzeniem",
  "priority": 5,
  "cooldown": 30,
  "trigger": {
    "type": "automatic",
    "conditions": {
      "and": {
        "conditions": [
          {
            "client_state": {
              "any_service_in_state": [
                "FAULT"
              ]
            }
          },
          {
            "error_message": {
              "mode": "contains",
              "pattern": "feeder1",
              "case_sensitive": false,
              "fault_clients_only": true
            }
          }
        ]
      }
    }
  },
  "actions": [
    {
      "type": "log_event",
      "level": "warning",
      "message": "ğŸš¨ BÅÄ„D WYDAWKI: Wykryto problem z feeder1 - uruchamiam procedurÄ™ wyÅ‚Ä…czenia",
      "description": "Alert o wykryciu bÅ‚Ä™du wydawki feeder1"
    },
    {
      "type": "send_sms",
      "description": "Powiadomienie SMS o bÅ‚Ä™dzie wydawki",
      "to": [
        "48517383507"
      ],
      "text": "[WYDAWKA] BÅ‚Ä…d feeder1: {{ clients_error_messages }}. Wydawka zostanie wyÅ‚Ä…czona."
    },
    {
      "type": "send_email",
      "description": "Powiadomienie email o bÅ‚Ä™dzie wydawki",
      "to": [
        "norbert.niemc@pomagier.info"
      ],
      "subject": "[WYDAWKA] BÅ‚Ä…d feeder1 - wyÅ‚Ä…czenie urzÄ…dzenia",
      "body": "Wykryto bÅ‚Ä…d wydawki feeder1.\n\nSzczegÃ³Å‚y bÅ‚Ä™du:\n{{ clients_error_messages }}\n\nWydawka zostanie automatycznie wyÅ‚Ä…czona aby zapobiec dalszym problemom.\n\nWymagana interwencja serwisowa."
    },
    {
      "type": "log_event",
      "level": "info",
      "message": "âš™ï¸ WyÅ‚Ä…czam wydawkÄ™ feeder1 z powodu bÅ‚Ä™du: {{ error_message }}",
      "description": "Informacja o wyÅ‚Ä…czeniu wydawki"
    },
    {
      "type": "send_command",
      "client": "io",
      "command": "CMD_ACK",
      "description": "WyÅ‚Ä…czenie wydawki feeder1"
    },
    {
      "type": "wait_for_state",
      "client": "io",
      "target_state": "STOPPED",
      "timeout": "10s",
      "description": "Oczekiwanie na potwierdzenie wyÅ‚Ä…czenia wydawki"
    },
    {
      "type": "log_event",
      "level": "warning",
      "message": "ğŸ”§ WYDAWKA WYÅÄ„CZONA: feeder1 zostaÅ‚a wyÅ‚Ä…czona z powodu bÅ‚Ä™du",
      "description": "Potwierdzenie wyÅ‚Ä…czenia wydawki"
    },
    {
      "type": "send_sms",
      "description": "Potwierdzenie wyÅ‚Ä…czenia wydawki (SMS)",
      "to": [
        "48517383507"
      ],
      "text": "Wydawka feeder1 zostaÅ‚a wyÅ‚Ä…czona. System kontynuuje pracÄ™ bez tej wydawki."
    },
    {
      "type": "send_email",
      "description": "Raport o wyÅ‚Ä…czeniu wydawki",
      "to": [
        "norbert.niemc@pomagier.info"
      ],
      "subject": "[INFO] Wydawka feeder1 wyÅ‚Ä…czona",
      "body": "Wydawka feeder1 zostaÅ‚a pomyÅ›lnie wyÅ‚Ä…czona z powodu wykrytego bÅ‚Ä™du.\n\nSystem kontynuuje pracÄ™ z pozostaÅ‚ymi wydawkami.\n\nAby ponownie wÅ‚Ä…czyÄ‡ wydawkÄ™:\n1. UsuÅ„ przyczynÄ™ bÅ‚Ä™du\n2. Uruchom procedurÄ™ testowÄ…\n3. WÅ‚Ä…cz wydawkÄ™ rÄ™cznie lub zrestartuj system"
    },
    {
      "type": "log_event",
      "level": "info",
      "message": "ğŸ’¡ INSTRUKCJA: Aby ponownie wÅ‚Ä…czyÄ‡ feeder1, usuÅ„ przyczynÄ™ bÅ‚Ä™du i uruchom procedurÄ™ testowÄ…",
      "description": "Instrukcja dla operatora"
    }
  ]
}

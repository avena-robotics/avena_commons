{
  "name": "Wstrzymanie systemu przy bdach (@all)",
  "description": "Autonomiczny scenariusz bezpieczestwa - wstrzymuje wszystkie usugi gdy wykryty zostanie bd",
  "priority": 10,
  "cooldown": 10,
  "trigger": {
    "type": "automatic",
    "conditions": {
      "and": {
        "conditions": [
          {
            "client_state": {
              "any_service_in_state": ["FAULT"]
            }
          },
          {
            "client_state": {
              "no_service_in_state": ["PAUSE"]
            }
          }
        ]
      }
    }
  },
  "actions": [
    {
      "type": "log_event",
      "level": "error",
      "message": " BD KRYTYCZNY: Wykryto komponent w stanie bdu - uruchamiam procedur bezpieczestwa",
      "description": "Alert o wykryciu bdu krytycznego"
    },
    {
      "type": "send_sms",
      "description": "Powiadomienie SMS o wykryciu bdu",
      "to": ["48517383507"],
      "text": "[ALERT] Wykryto stan FAULT w {{ clients_in_fault }}."
    },
    {
      "type": "send_email",
      "description": "Powiadomienie o wykryciu bdu",
      "to": ["norbert.niemc@pomagier.info", "mikolaj.galant@pomagier.info", "damian.gawin@pomagier.info"],
      "subject": "[ALERT] Wykryto FAULT w {{ clients_in_fault }}",
      "body": "Wykryto stan FAULT. 殴r贸do: {{ trigger.source }}. Lista klient贸w w bdzie: {{ clients_in_fault }}"
    },
    {
      "type": "log_event",
      "level": "warning",
      "message": "锔 PROCEDURA BEZPIECZESTWA: Wstrzymuj wszystkie usugi aby zapobiec dalszym uszkodzeniom",
      "description": "Informacja o rozpoczciu procedury bezpieczestwa"
    },
    {
      "type": "log_event",
      "level": "info",
      "message": "革 Autonomiczne wstrzymywanie wszystkich komponent贸w (@all)...",
      "description": "Rozpoczcie autonomicznego wstrzymywania"
    },
    {
      "type": "send_command",
      "target": "@all",
      "command": "CMD_PAUSE",
      "description": "Wstrzymanie wszystkich komponent贸w systemu"
    },
    {
      "type": "wait_for_state",
      "target": "@all",
      "target_state": ["PAUSE", "FAULT"],
      "timeout": "30s",
      "description": "Oczekiwanie na wstrzymanie wszystkich komponent贸w"
    },
    {
      "type": "log_event",
      "level": "warning",
      "message": " SYSTEM ZABEZPIECZONY: Wszystkie usugi wstrzymane z powodu wykrycia bdu",
      "description": "Potwierdzenie zabezpieczenia systemu"
    },
    {
      "type": "send_sms",
      "description": "Raport po wstrzymaniu usug (SMS)",
      "to": ["48517383507"],
      "text": "Wszystkie komponenty zostay wstrzymane. Wymagana interwencja administratora. Lista: {{ clients_in_fault }}"
    },
    {
      "type": "send_email",
      "description": "Raport po wstrzymaniu usug",
      "to": ["norbert.niemc@pomagier.info", "mikolaj.galant@pomagier.info", "damian.gawin@pomagier.info"],
      "subject": "[INFO] System wstrzymany - komponenty w bdzie: {{ clients_in_fault }}",
      "body": "Wszystkie komponenty zostay wstrzymane (PAUSED). Wymagana interwencja administratora. Lista: {{ clients_in_fault }}"
    },
    {
      "type": "log_event",
      "level": "info",
      "message": " Wstrzymane komponenty: @all - wymagana interwencja administratora",
      "description": "Lista wstrzymanych komponent贸w"
    },
    {
      "type": "log_event",
      "level": "warning",
      "message": " WYMAGANA AKCJA: Sprawd藕 komponenty w bdzie i usu przyczyn przed ponownym uruchomieniem",
      "description": "Instrukcja dla administratora"
    },
    {
      "type": "log_event",
      "level": "info",
      "message": " Aby uruchomi ponownie: usu bdy i uruchom scenariusz startup lub restart systemu",
      "description": "Wskaz贸wka dotyczca powrotu do pracy"
    }
  ]
}

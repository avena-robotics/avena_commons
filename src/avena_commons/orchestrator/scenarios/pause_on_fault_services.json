{
  "name": "Wstrzymanie systemu przy błędach (@all)",
  "description": "Autonomiczny scenariusz bezpieczeństwa - wstrzymuje wszystkie usługi gdy wykryty zostanie błąd",
  "priority": 10,
  "cooldown": 10,
  "trigger": {
    "type": "automatic",
    "conditions": {
      "and": {
        "conditions": [
          {
            "client_state": {
              "any_service_in_state": ["FAULT"]
            }
          },
          {
            "client_state": {
              "no_service_in_state": ["PAUSE"]
            }
          }
        ]
      }
    }
  },
  "actions": [
    {
      "type": "log_event",
      "level": "error",
      "message": "🚨 BŁĄD KRYTYCZNY: Wykryto komponent w stanie błędu - uruchamiam procedurę bezpieczeństwa",
      "description": "Alert o wykryciu błędu krytycznego"
    },
    {
      "type": "send_sms",
      "description": "Powiadomienie SMS o wykryciu błędu",
      "to": ["48517383507"],
      "text": "[ALERT] Wykryto stan FAULT w {{ clients_in_fault }}."
    },
    {
      "type": "send_email",
      "description": "Powiadomienie o wykryciu błędu",
      "to": ["norbert.niemc@pomagier.info", "mikolaj.galant@pomagier.info", "damian.gawin@pomagier.info"],
      "subject": "[ALERT] Wykryto FAULT w {{ clients_in_fault }}",
      "body": "Wykryto stan FAULT. Źródło: {{ trigger.source }}. Lista klientów w błędzie: {{ clients_in_fault }}"
    },
    {
      "type": "log_event",
      "level": "warning",
      "message": "⚠️ PROCEDURA BEZPIECZEŃSTWA: Wstrzymuję wszystkie usługi aby zapobiec dalszym uszkodzeniom",
      "description": "Informacja o rozpoczęciu procedury bezpieczeństwa"
    },
    {
      "type": "log_event",
      "level": "info",
      "message": "⏸️ Autonomiczne wstrzymywanie wszystkich komponentów (@all)...",
      "description": "Rozpoczęcie autonomicznego wstrzymywania"
    },
    {
      "type": "send_command",
      "target": "@all",
      "command": "CMD_PAUSE",
      "description": "Wstrzymanie wszystkich komponentów systemu"
    },
    {
      "type": "wait_for_state",
      "target": "@all",
      "target_state": ["PAUSE", "FAULT"],
      "timeout": "30s",
      "description": "Oczekiwanie na wstrzymanie wszystkich komponentów"
    },
    {
      "type": "log_event",
      "level": "warning",
      "message": "🛑 SYSTEM ZABEZPIECZONY: Wszystkie usługi wstrzymane z powodu wykrycia błędu",
      "description": "Potwierdzenie zabezpieczenia systemu"
    },
    {
      "type": "send_sms",
      "description": "Raport po wstrzymaniu usług (SMS)",
      "to": ["48517383507"],
      "text": "Wszystkie komponenty zostały wstrzymane. Wymagana interwencja administratora. Lista: {{ clients_in_fault }}"
    },
    {
      "type": "send_email",
      "description": "Raport po wstrzymaniu usług",
      "to": ["norbert.niemc@pomagier.info", "mikolaj.galant@pomagier.info", "damian.gawin@pomagier.info"],
      "subject": "[INFO] System wstrzymany - komponenty w błędzie: {{ clients_in_fault }}",
      "body": "Wszystkie komponenty zostały wstrzymane (PAUSED). Wymagana interwencja administratora. Lista: {{ clients_in_fault }}"
    },
    {
      "type": "log_event",
      "level": "info",
      "message": "📋 Wstrzymane komponenty: @all - wymagana interwencja administratora",
      "description": "Lista wstrzymanych komponentów"
    },
    {
      "type": "log_event",
      "level": "warning",
      "message": "🔧 WYMAGANA AKCJA: Sprawdź komponenty w błędzie i usuń przyczynę przed ponownym uruchomieniem",
      "description": "Instrukcja dla administratora"
    },
    {
      "type": "log_event",
      "level": "info",
      "message": "💡 Aby uruchomić ponownie: usuń błędy i uruchom scenariusz startup lub restart systemu",
      "description": "Wskazówka dotycząca powrotu do pracy"
    }
  ]
}

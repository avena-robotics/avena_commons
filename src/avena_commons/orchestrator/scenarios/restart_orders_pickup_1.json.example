{
  "name": "Restart zamÃ³wieÅ„ z wydawki 1",
  "description": "Restart zamÃ³wieÅ„ z niesprawnej wydawki pickup_number=1 do dziaÅ‚ajÄ…cych wydawek",
  "version": "1.0",
  "author": "System APS",
  "priority": 70,
  "cooldown": 300,
  "trigger": {
    "type": "manual",
    "description": "RÄ™czne uruchomienie restartu zamÃ³wieÅ„ z wydawki 1",
    "conditions": {
      "database_list": {
        "component": "main_database",
        "table": "aps_order",
        "columns": [
          "id", "aps_id", "origin", "status", "pickup_number",
          "kds_order_number", "client_phone_number", "estimated_time", 
          "transaction_id", "marketing_consent", "terms_accepted", 
          "privacy_accepted", "promo_consent"
        ],
        "where": {
          "pickup_number": "1",
          "status": "pending"
        },
        "result_key": "zamowienia_pickup_1",
        "limit": 50,
        "order_by": "created_at ASC"
      }
    }
  },
  "actions": [
    {
      "type": "log_event",
      "level": "info",
      "message": "ğŸ”„ Rozpoczynam restart {{ trigger.zamowienia_pickup_1|length }} zamÃ³wieÅ„ z wydawki pickup_number=1",
      "description": "RozpoczÄ™cie procesu restartu zamÃ³wieÅ„"
    },
    {
      "type": "restart_orders",
      "component": "main_database",
      "orders_source": "{{ trigger.zamowienia_pickup_1 }}",
      "clone_config": {
        "copy_fields": [
          "aps_id", "origin", "kds_order_number", "client_phone_number",
          "estimated_time", "transaction_id", "marketing_consent", 
          "terms_accepted", "privacy_accepted", "promo_consent"
        ],
        "skip_fields": ["pickup_number"],
        "default_values": {}
      },
      "description": "Restart zamÃ³wieÅ„ z weryfikacjÄ… dostÄ™pnoÅ›ci produktÃ³w"
    },
    {
      "type": "log_event",
      "level": "success",
      "message": "âœ… Restart zamÃ³wieÅ„ zakoÅ„czony. Sklonowanych: {{ action_result.success_count }}, Refund: {{ action_result.refund_count }}, BÅ‚Ä™dy: {{ action_result.error_count }}",
      "description": "Podsumowanie restartu zamÃ³wieÅ„"
    },
    {
      "type": "send_email",
      "to": "{{ trigger.admin_email }}",
      "subject": "ğŸ”„ Restart zamÃ³wieÅ„ z wydawki 1 - raport",
      "body": "Restart zamÃ³wieÅ„ z wydawki pickup_number=1 zostaÅ‚ zakoÅ„czony.\n\nğŸ“Š Podsumowanie:\n- ÅÄ…cznie przetworzonych: {{ action_result.total_count }}\n- PomyÅ›lnie sklonowanych: {{ action_result.success_count }}\n- Ustawiono na refund_pending: {{ action_result.refund_count }}\n- BÅ‚Ä™dy: {{ action_result.error_count }}\n\n{% if action_result.refund_count > 0 %}ğŸš¨ Uwaga: {{ action_result.refund_count }} zamÃ³wieÅ„ wymaga interwencji (brak produktÃ³w w magazynie).{% endif %}\n\nSystem automatycznie przypisze nowe zamÃ³wienia do dziaÅ‚ajÄ…cych wydawek.",
      "description": "Powiadomienie email o wyniku restartu"
    }
  ]
}

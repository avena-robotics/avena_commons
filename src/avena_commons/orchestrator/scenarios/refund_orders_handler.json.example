{
  "name": "Obs≈Çuga zam√≥wie≈Ñ do zwrotu",
  "description": "Automatyczny scenariusz obs≈ÇugujƒÖcy zam√≥wienia w stanie refund",
  "version": "1.0",
  "author": "System",
  "priority": 80,
  "cooldown": 300,
  "trigger": {
    "type": "automatic",
    "description": "Uruchomienie gdy istniejƒÖ zam√≥wienia do zwrotu",
    "conditions": {
      "database_list": {
        "component": "main_database",
        "table": "zamowienia",
        "columns": [
          "id",
          "numer_zamowienia",
          "klient_id",
          "stan_zamowienia",
          "wartosc_zamowienia",
          "data_utworzenia"
        ],
        "where": {
          "stan_zamowienia": "refund"
        },
        "result_key": "zamowienia_do_zwrotu",
        "limit": 50,
        "order_by": "data_utworzenia ASC"
      }
    }
  },
  "actions": [
    {
      "type": "log_event",
      "level": "info",
      "message": "üîÑ Rozpoczynam obs≈Çugƒô zam√≥wie≈Ñ do zwrotu - znaleziono {{ trigger.zamowienia_do_zwrotu|length }} zam√≥wie≈Ñ",
      "description": "Informacja o rozpoczƒôciu procesu obs≈Çugi zwrot√≥w"
    },
    {
      "type": "send_email",
      "description": "Powiadomienie o zam√≥wieniach do zwrotu",
      "to": [
        "zwroty@firma.pl",
        "kierownik@firma.pl"
      ],
      "subject": "Zam√≥wienia do zwrotu - {{ trigger.zamowienia_do_zwrotu|length }} pozycji",
      "body": "Wykryto nastƒôpujƒÖce zam√≥wienia do zwrotu:\n\n{% for zamowienie in trigger.zamowienia_do_zwrotu %}‚Ä¢ Zam√≥wienie {{ zamowienie.numer_zamowienia }} - Klient {{ zamowienie.klient_id }} - Warto≈õƒá {{ zamowienie.wartosc_zamowienia }} PLN\n{% endfor %}\n\nProszƒô o pilne przetworzenie."
    },
    {
      "type": "log_event",
      "level": "success", 
      "message": "‚úÖ Powiadomienia o zwrotach zosta≈Çy wys≈Çane",
      "description": "Potwierdzenie wys≈Çania powiadomie≈Ñ"
    },
    {
      "type": "aps_database_update",
      "description": "Oznaczenie zam√≥wie≈Ñ jako przetwarzane",
      "component": "main_database",
      "table": "zamowienia",
      "update_column": "stan_zamowienia",
      "update_value": "refund_processing",
      "where_column": "stan_zamowienia",
      "where_value": "refund"
    }
  ]
}
